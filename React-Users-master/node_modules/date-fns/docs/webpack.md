# webpack

## Removing unused languages from dynamic import

<<<<<<< HEAD
If a locale is imported dynamically, then all locales from date-fns are loaded by webpack into a bundle (~160kb) or split across the chunks. This prolongs the build process and increases the amount of space taken. However, it is possible to use webpack to trim down languages using [ContextReplacementPlugin].
=======
If locale is required dynamically all languages in the date-fns are loaded by webpack into bundle (~160kb) or split across the chunks. This prolongs the build process and increases the amount of space taken. However, it is possible to use webpack to trim down languages using [ContextReplacementPlugin].
>>>>>>> f65d1c32 (Fix all bugs)

Let's assume that we have a single point in which supported locales are present:

`config.js`:

```js
<<<<<<< HEAD
// `see date-fns/src/locale` for available locales
export const supportedLocales = ['en-US', 'de', 'pl', 'it']
=======
export const supportedLocales = ['en', 'de', 'pl', 'it']
>>>>>>> f65d1c32 (Fix all bugs)
```

We could also have a function that formats the date:

```js
<<<<<<< HEAD
const getLocale = (locale) => import(`date-fns/locale/${locale}/index.js`) // or require() if using CommonJS

const formatDate = (date, formatStyle, locale) => {
  return format(date, formatStyle, {
    locale: getLocale(locale),
=======
const getLocale = locale => require(`date-fns/locale/${locale}/index.js`)

const formatDate = (date, formatStyle, locale) => {
  return format(date, formatStyle, {
    locale: getLocale(locale)
>>>>>>> f65d1c32 (Fix all bugs)
  })
}
```

In order to exclude unused languages we can use webpacks [ContextReplacementPlugin].

`webpack.config.js`:

```js
import webpack from 'webpack'
import { supportedLocales } from './config.js'

export default const config = {
  plugins: [
    new webpack.ContextReplacementPlugin(
<<<<<<< HEAD
      /^date-fns[/\\]locale$/,
      new RegExp(`\\.[/\\\\](${supportedLocales.join('|')})[/\\\\]index\\.js$`)
=======
      /date\-fns[\/\\]/,
      new RegExp(`[/\\\\\](${supportedLocales.join('|')})[/\\\\\]`)
>>>>>>> f65d1c32 (Fix all bugs)
    )
  ]
}
```

This results in a language bundle of ~23kb .

<<<<<<< HEAD
[contextreplacementplugin]: https://webpack.js.org/plugins/context-replacement-plugin/
=======
[ContextReplacementPlugin]: https://webpack.js.org/plugins/context-replacement-plugin/
>>>>>>> f65d1c32 (Fix all bugs)
